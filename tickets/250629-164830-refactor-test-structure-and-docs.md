---
priority: 2
tags: ["refactoring", "testing", "documentation"]
description: "テストスイートの再構成とドキュメントの分離"
created_at: "2025-06-29T16:48:30Z"
started_at: null  # Do not modify manually
closed_at: null   # Do not modify manually
---

# テストスイートの再構成とドキュメントの分離

テストファイルの構造を整理し、開発者向けドキュメント（DEV.md）と利用者向けドキュメント（README.md）を分離する。

## 背景

現在のテストスイートには以下の問題がある：

1. **重複するテストファイル**: `test-basic.sh`、`test-simple.sh`、`test-comprehensive.sh`、`test-final.sh`が似たような基本機能テストを含んでいる
2. **不明確な命名**: `test-additional.sh`と`test-missing-coverage.sh`の区別が不明確
3. **フラットな構造**: テストの種類や目的が分かりにくい
4. **ドキュメントの混在**: README.mdに利用者向けと開発者向けの情報が混在している

## Tasks

### 1. テストドキュメントの作成
- [ ] `test/README.md`を作成し、各テストファイルの現在の目的を文書化
- [ ] 各テストファイルで何をテストしているかを明確にする
- [ ] 実行順序や依存関係を記載

### 2. ドキュメントの分離
- [ ] `DEV.md`を作成し、開発者向け情報を移動
  - [ ] アーキテクチャの説明
  - [ ] テストの実行方法
  - [ ] 開発環境のセットアップ
  - [ ] コントリビューションガイドライン
- [ ] `README.md`を利用者向けに簡潔に更新
  - [ ] インストール方法
  - [ ] 基本的な使い方
  - [ ] 簡単な例
  - [ ] DEV.mdへのリンク

### 3. 重複テストの統合計画
- [ ] 重複している4つの基本テストファイルの内容を分析
- [ ] 統合計画を文書化（実際の統合は別チケット）
- [ ] 各テストの特徴と違いを明確化

### 4. 将来的な構造改善の提案
- [ ] 理想的なテスト構造の設計案を作成
- [ ] 移行計画の概要を文書化
- [ ] 破壊的変更を避ける段階的移行方法を検討

### 5. spec.mdとの照合によるテストカバレッジ確認
- [ ] spec.mdに記載されている全ての仕様を洗い出し
- [ ] 現在のテストケースとspec.mdの仕様を照合
- [ ] カバーされていない仕様のリストを作成
- [ ] 不足しているテストケースを特定

### 6. 必要なテストケースの追加
- [ ] spec.mdとの照合で見つかった不足テストをリスト化
- [ ] 優先度を付けて実装計画を作成
- [ ] 新しいテストケースを適切なファイルに追加

### 7. テスト実行の検証
- [ ] `./run-all.sh`でローカルテストが全て成功することを確認
- [ ] `./run-all-on-docker.sh`でDocker環境（Ubuntu/Alpine）でのテストが成功することを確認
- [ ] テスト結果のサマリーをドキュメントに記載

## 提案する将来的なテスト構造

```
test/
├── README.md                 # テストスイートの説明
├── helpers/                  # ヘルパー関数
│   ├── test-helpers.sh
│   └── test-compat.sh
├── unit/                     # 単体テスト（コマンドごと）
│   ├── test-init.sh
│   ├── test-new.sh
│   ├── test-list.sh
│   ├── test-start.sh
│   ├── test-close.sh
│   └── test-restore.sh
├── features/                 # 機能テスト
│   ├── test-close-force.sh
│   └── test-done-folder.sh
├── integration/              # 統合テスト
│   └── test-workflow.sh      # 完全なワークフロー
├── edge-cases/               # エッジケース
│   └── test-edge-cases.sh
└── run-all.sh               # 統一テストランナー
```

## 注意事項

- 現在のテストスイートは正常に動作しているため、実際のリファクタリングは慎重に行う
- CIや既存のドキュメントへの影響を最小限に抑える
- 破壊的変更は避け、段階的に移行する
- まずはドキュメント化から始め、実際の構造変更は別チケットで行う

## 期待される成果

1. **開発者体験の向上**: テストの目的が明確になり、新規開発者が理解しやすくなる
2. **保守性の向上**: 重複が減り、テストの管理が容易になる
3. **ドキュメントの改善**: 利用者と開発者それぞれに適した情報提供
4. **将来的な拡張性**: 新しいテストを追加する際の指針が明確になる
5. **テストカバレッジの向上**: spec.mdの全仕様がテストでカバーされる
6. **信頼性の向上**: すべての環境（ローカル、Ubuntu Docker、Alpine Docker）でテストが成功する
